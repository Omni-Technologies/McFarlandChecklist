<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>McFarland PSC - Device Checklist</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        /* Custom Styles */
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f0f4f8;
            color: #1e293b;
        }
        .header {
            background-color: #334155;
            color: #f8fafc;
        }
        .btn-danger {
            background-color: #dc2626;
            color: white;
            transition: background-color 0.3s ease;
        }
        .btn-danger:hover {
            background-color: #b91c1c;
        }
        .device-card {
            background-color: white;
            border-radius: 0.75rem;
            box-shadow: 0 4px 6px -1px rgb(0 0 0 / 0.1), 0 2px 4px -2px rgb(0 0 0 / 0.1);
            transition: all 0.2s ease-in-out;
            border-left: 5px solid transparent;
        }
        .device-card.checked {
            background-color: #eef2ff;
            border-left-color: #4f46e5;
        }
        .sticky-footer {
            backdrop-filter: blur(10px);
            background-color: rgba(255, 255, 255, 0.85);
        }
        /* Custom checkbox */
        .custom-checkbox {
            -webkit-appearance: none;
            appearance: none;
            background-color: #fff;
            margin: 0;
            font: inherit;
            color: currentColor;
            width: 1.75em;
            height: 1.75em;
            border: 0.15em solid #cbd5e1;
            border-radius: 0.375rem;
            transform: translateY(-0.075em);
            display: grid;
            place-content: center;
            cursor: pointer;
            transition: background-color 0.2s, border-color 0.2s;
        }
        .custom-checkbox:checked {
            background-color: #4f46e5;
            border-color: #4f46e5;
        }
        .custom-checkbox::before {
            content: "";
            width: 1em;
            height: 1em;
            transform: scale(0);
            transition: 120ms transform ease-in-out;
            box-shadow: inset 1em 1em white;
            transform-origin: bottom left;
            clip-path: polygon(14% 44%, 0 65%, 50% 100%, 100% 16%, 80% 0%, 43% 62%);
        }
        .custom-checkbox:checked::before {
            transform: scale(1);
        }
        /* Progress Bar */
        .progress-bar {
            background-color: #4f46e5;
            transition: width 0.5s ease-in-out;
        }
        /* Details/Summary for Accordion */
        details > summary {
            list-style: none;
            cursor: pointer;
        }
        details > summary::-webkit-details-marker {
            display: none;
        }
        .summary-arrow {
            transition: transform 0.2s;
        }
        details[open] .summary-arrow {
            transform: rotate(90deg);
        }
    </style>
</head>
<body class="antialiased">

    <!-- Header Section -->
    <header class="header shadow-md p-4 sticky top-0 z-20">
        <div class="container mx-auto max-w-7xl">
            <h1 class="text-2xl md:text-3xl font-bold text-center">McFarland Public Safety Center</h1>
            <p class="text-center text-slate-300 text-sm md:text-base">Fire Alarm Device Checklist</p>
        </div>
    </header>

    <!-- Main Content -->
    <main class="container mx-auto max-w-7xl p-4 md:p-6 pb-24">

        <!-- Progress Bar and Stats -->
        <div class="mb-6 bg-white p-4 rounded-xl shadow-sm">
             <div id="progress-stats" class="text-center text-slate-600 mb-2 font-medium">0 / 0 Devices Checked</div>
             <div class="bg-slate-200 rounded-full overflow-hidden h-8">
                <div id="progress-bar" class="progress-bar h-full rounded-full flex items-center justify-center text-white font-bold" style="width: 0%;">0%</div>
             </div>
        </div>

        <!-- Controls: Search, Sort, and Clear -->
        <div class="mb-6 bg-white p-4 rounded-xl shadow-sm sticky top-[105px] z-10">
            <div class="grid grid-cols-1 md:grid-cols-4 gap-4 items-end">
                <div class="md:col-span-2">
                    <label for="search" class="block text-sm font-medium text-slate-600 mb-1">Search Devices</label>
                    <input type="text" id="search" placeholder="E.g., BASEMENT SMOKE, 278, 3939..." class="w-full px-4 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500">
                </div>
                <div>
                    <label for="sortBy" class="block text-sm font-medium text-slate-600 mb-1">Sort By</label>
                    <select id="sortBy" class="w-full px-4 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500">
                        <option value="address">Address (Asc)</option>
                        <option value="address-desc">Address (Desc)</option>
                        <option value="loop">Loop</option>
                        <option value="model">Model</option>
                        <option value="deviceType">Device Type</option>
                    </select>
                </div>
                <div>
                    <button id="clear-all" class="w-full btn-danger px-4 py-2 rounded-lg font-semibold">Clear All</button>
                </div>
            </div>
        </div>

        <!-- Collapsible Completed Devices Section -->
        <details id="completed-section" class="bg-white rounded-xl shadow-sm mb-6" open>
            <summary class="p-4 flex justify-between items-center">
                <div class="flex items-center gap-2">
                    <svg class="summary-arrow h-5 w-5 text-slate-500" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="9 18 15 12 9 6"></polyline></svg>
                    <h2 class="text-xl font-bold text-slate-700">Completed Devices</h2>
                </div>
                <span id="completed-count" class="bg-indigo-100 text-indigo-700 font-bold text-sm px-3 py-1 rounded-full">0</span>
            </summary>
            <div id="completed-device-list" class="p-4 pt-0 grid grid-cols-1 gap-4">
                <!-- Completed devices will be moved here -->
            </div>
        </details>

        <!-- Unchecked Device List Container -->
        <h2 class="text-xl font-bold text-slate-700 mb-4">Remaining Devices</h2>
        <div id="device-list" class="grid grid-cols-1 gap-4">
            <!-- Unchecked devices will be rendered here -->
        </div>

    </main>

    <!-- Sticky Footer for Previous Device -->
    <footer id="previous-device-footer" class="sticky bottom-0 left-0 right-0 p-3 border-t border-slate-200 sticky-footer hidden z-20">
        <div class="container mx-auto max-w-7xl text-center">
            <p class="text-sm text-slate-600 font-medium">Last Checked: <span id="previous-device-text" class="font-bold text-indigo-700"></span></p>
        </div>
    </footer>

    <script>
        // --- DATA FROM PDF ---
        const devices = [
            // Detectors
            { loop: 1, address: 1, model: 'PS', deviceType: 'Smoke Verified', serialNumber: '3939747909', messages: 'BASEMENT SMOKE ABOVE FACP' },
            { loop: 1, address: 2, model: 'HRS', deviceType: 'Heat ROR', serialNumber: '3831067556', messages: 'BASEMENT HEAT BY SPRINK PIPING' },
            { loop: 1, address: 3, model: 'HRS', deviceType: 'Heat ROR', serialNumber: '3828858723', messages: 'BASEMENT HEAT MECHANICAL RM' },
            { loop: 1, address: 4, model: 'PS', deviceType: 'Smoke Verified', serialNumber: '3939754204', messages: 'BASEMENT SMOKE ELEVATOR SMOKE' },
            { loop: 1, address: 5, model: 'HRS', deviceType: 'Heat ROR', serialNumber: '3828858570', messages: 'BASEMENT HEAT OUTSIDE PANEL RM' },
            { loop: 1, address: 6, model: 'HRS', deviceType: 'Heat ROR', serialNumber: '3828849349', messages: 'BASEMENT HEAT ABOVE PANEL' },
            { loop: 1, address: 7, model: 'HRS', deviceType: 'Heat ROR', serialNumber: '3828845501', messages: 'BASEMENT HEAT MIDDLE/STAIRWELL B' },
            { loop: 1, address: 8, model: 'HRS', deviceType: 'Heat ROR', serialNumber: '3828862416', messages: 'BASEMENT HEAT FAR MIDDLE/STAIR A' },
            { loop: 1, address: 9, model: 'HRS', deviceType: 'Heat ROR', serialNumber: '3828845457', messages: 'BASEMENT HEAT NORTH/STAIRWELL A' },
            { loop: 1, address: 10, model: 'SD', deviceType: 'Duct Supervisory Latching', serialNumber: '3969261901', messages: 'APPATURE BAY MEZ DUCT DETECTOR' },
            { loop: 1, address: 11, model: 'PS', deviceType: 'Smoke Verified', serialNumber: '3939777975', messages: 'PENTHOUSE SMOKE ABOVE BOSCH DIALER' },
            { loop: 1, address: 12, model: 'PS', deviceType: 'Smoke Verified', serialNumber: '3939754365', messages: 'SOUTH STAIRWELL SMOKE DETECTOR' },
            { loop: 1, address: 13, model: 'PS', deviceType: 'Smoke Verified', serialNumber: '3939647735', messages: 'OUTSIDE SOUTH STAIR NEXT TO EXTERIOR DR' },
            { loop: 1, address: 14, model: 'PS', deviceType: 'Smoke Verified', serialNumber: '3939753535', messages: '1ST FLOOR SMOKE CORRIDOR TO STAIR B' },
            { loop: 1, address: 15, model: 'PS', deviceType: 'Smoke Verified', serialNumber: '3939753511', messages: '1ST FLOOR SMOKE S/E APP BAY' },
            { loop: 1, address: 16, model: 'PS', deviceType: 'Smoke Verified', serialNumber: '3939754167', messages: '1ST FLOOR SMOKE ELEVATOR SMOKE' },
            { loop: 1, address: 17, model: 'PS', deviceType: 'Smoke Verified', serialNumber: '3939755119', messages: '1ST FLOOR SMOKE OUTSIDE ELEVATOR' },
            { loop: 1, address: 18, model: 'SD', deviceType: 'Duct Supervisory Latching', serialNumber: '3912816448', messages: '1ST FLOOR DUCT STAIRWELL B' },
            { loop: 1, address: 19, model: 'SD', deviceType: 'Duct Supervisory Latching', serialNumber: '3912816295', messages: '1ST FLOOR DUCT STAIRWELL B' },
            { loop: 1, address: 20, model: 'PS', deviceType: 'Smoke Verified', serialNumber: '3939754259', messages: '1ST FLOOR SMOKE EAST APP BAY' },
            { loop: 1, address: 21, model: 'PS', deviceType: 'Smoke Verified', serialNumber: '3939754297', messages: '1ST FLOOR SMOKE TRAINING STORAGE' },
            { loop: 1, address: 22, model: 'PS', deviceType: 'Smoke Verified', serialNumber: '3939755096', messages: '1ST FLOOR SMOKE MEDICAL STORAGE' },
            { loop: 1, address: 23, model: 'PS', deviceType: 'Smoke Verified', serialNumber: '3939755225', messages: '1ST FLOOR SMOKE IT/COMM ROOM' },
            { loop: 1, address: 24, model: 'PS', deviceType: 'Smoke Verified', serialNumber: '3939754020', messages: '1ST FLOOR SMOKE JANITOR STORAGE' },
            { loop: 1, address: 25, model: 'PS', deviceType: 'Smoke Verified', serialNumber: '3939747961', messages: '1ST FLOOR SMOKE AV STORAGE ROOM' },
            { loop: 1, address: 26, model: 'PS', deviceType: 'Smoke Verified', serialNumber: '3939754792', messages: '1ST FLOOR SMOKE COURT STORAGE' },
            { loop: 1, address: 27, model: 'PS', deviceType: 'Smoke Verified', serialNumber: '3939753962', messages: '1ST FLOOR POLICE SM EVIDENCE PROC. STOR.' },
            { loop: 1, address: 28, model: 'PS', deviceType: 'Smoke Verified', serialNumber: '3939753849', messages: '1ST FLOOR SMOKE POLICE IT CLOSET' },
            { loop: 1, address: 29, model: 'PS', deviceType: 'Smoke Verified', serialNumber: '3939753832', messages: '1ST FLOOR SMOKE POLICE SHOWER STRG' },
            { loop: 1, address: 30, model: 'PS', deviceType: 'Smoke Verified', serialNumber: '3939759575', messages: '1ST FLOOR SMOKE POLICE INVEST RM' },
            { loop: 1, address: 31, model: 'PS', deviceType: 'Smoke Verified', serialNumber: '3939758134', messages: '1ST FLOOR SMOKE POLICE P120 STORAGE' },
            { loop: 1, address: 32, model: 'PS', deviceType: 'Smoke Verified', serialNumber: '3939754921', messages: '1ST FLOOR SMOKE POLICE MECH RM' },
            { loop: 1, address: 33, model: 'HRS', deviceType: 'Heat ROR', serialNumber: '3828859904', messages: '2ND FLOOR HEAT WEST MECH ROOM' },
            { loop: 1, address: 34, model: 'HRS', deviceType: 'Heat ROR', serialNumber: '3828858587', messages: '2ND FLOOR HEAT WEST MECH ROOM' },
            { loop: 1, address: 35, model: 'PS', deviceType: 'Smoke Verified', serialNumber: '3939735654', messages: '2ND FLOOR SMOKE STIARWELL B' },
            { loop: 1, address: 36, model: 'PS', deviceType: 'Smoke Verified', serialNumber: '3939754563', messages: 'TOP OF ELEVATOR SHAFT SMOKE' },
            { loop: 1, address: 37, model: 'PS', deviceType: 'Smoke Verified', serialNumber: '3939754266', messages: '2ND FLOOR SMOKE OUTSIDE ELEVATOR' },
            { loop: 1, address: 38, model: 'HFS', deviceType: 'Heat', serialNumber: '3622616017', messages: 'TOP OF ELEVATOR SHAFT HEAT' },
            { loop: 1, address: 39, model: 'PS', deviceType: 'Smoke Verified', serialNumber: '3939753870', messages: '2ND FLOOR SMOKE OUTSIDE DORM 12' },
            { loop: 1, address: 40, model: 'PS', deviceType: 'Supervisory Non-Latching', serialNumber: '3939776800', messages: '2ND FLOOR SMOKE DORM 12' },
            { loop: 1, address: 41, model: 'PS', deviceType: 'Smoke Verified', serialNumber: '3939754525', messages: '2ND FLOOR SMOKE OUTSIDE DORM 11' },
            { loop: 1, address: 42, model: 'PS', deviceType: 'Supervisory Non-Latching', serialNumber: '3939736088', messages: '2ND FLOOR SMOKE DORM 11' },
            { loop: 1, address: 43, model: 'PS', deviceType: 'Supervisory Non-Latching', serialNumber: '3939754242', messages: '2ND FLOOR SMOKE DORM 10' },
            { loop: 1, address: 44, model: 'PS', deviceType: 'Supervisory Non-Latching', serialNumber: '3939778194', messages: '2ND FLOOR SMOKE DORM 9' },
            { loop: 1, address: 45, model: 'PS', deviceType: 'Smoke Verified', serialNumber: '3939754945', messages: '2ND FLOOR SMOKE OUTSIDE DORM 8/9' },
            { loop: 1, address: 46, model: 'PS', deviceType: 'Supervisory Non-Latching', serialNumber: '3939754938', messages: '2ND FLOOR SMOKE DORM 8' },
            { loop: 1, address: 47, model: 'PS', deviceType: 'Supervisory Non-Latching', serialNumber: '3939754822', messages: '2ND FLOOR SMOKE DORM7' },
            { loop: 1, address: 48, model: 'PS', deviceType: 'Supervisory Non-Latching', serialNumber: '3939754044', messages: '2ND FLOOR SMOKE DORM 6' },
            { loop: 1, address: 49, model: 'PS', deviceType: 'Smoke Verified', serialNumber: '3939755102', messages: '2ND FLOOR SMOKE OUTSIDE DORM 5/6' },
            { loop: 1, address: 50, model: 'PS', deviceType: 'Supervisory Non-Latching', serialNumber: '3939747923', messages: '2ND FLOOR SMOKE DORM 5' },
            { loop: 1, address: 51, model: 'PS', deviceType: 'Supervisory Non-Latching', serialNumber: '3939753894', messages: '2ND FLOOR SMOKE DORM 4' },
            { loop: 1, address: 52, model: 'PS', deviceType: 'Smoke Verified', serialNumber: '3939755010', messages: '2ND FLOOR SMOKE OUTSIDE DORM 3/4' },
            { loop: 1, address: 53, model: 'PS', deviceType: 'Supervisory Non-Latching', serialNumber: '3939753856', messages: '2ND FLOOR SMOKE DORM 3' },
            { loop: 1, address: 54, model: 'PS', deviceType: 'Supervisory Non-Latching', serialNumber: '3939755065', messages: '2ND FLOOR SMOKE DORM 2' },
            { loop: 1, address: 55, model: 'PS', deviceType: 'Supervisory Non-Latching', serialNumber: '3939754433', messages: '2ND FLOOR SMOKE DORM 1' },
            { loop: 1, address: 56, model: 'PS', deviceType: 'Smoke Verified', serialNumber: '3939754952', messages: '2ND FLOOR SMOKE OUTSIDE DORM 1' },
            { loop: 1, address: 57, model: 'PS', deviceType: 'Smoke Verified', serialNumber: '3939747619', messages: '2ND FLOOR SMOKE NORTH STAIRWELL' },
            { loop: 1, address: 58, model: 'PS', deviceType: 'Smoke Verified', serialNumber: '3945817825', messages: '1ST FLOOR SMOKE ROLL DOWN DOOR' },
            { loop: 1, address: 60, model: 'PS', deviceType: 'Smoke Verified', serialNumber: '3934208757', messages: '1ST FLOOR SMOKE ROLL DOWN DOOR' },
            { loop: 1, address: 65, model: 'PS', deviceType: 'Smoke Verified', serialNumber: '3939758455', messages: 'SOUTH STAIRWELL ROOF ACCESS' },
            { loop: 1, address: 80, model: 'IM', deviceType: 'Monitor', serialNumber: '3698974301', messages: 'ISOLATOR MODULE BASEMENT FACP' },
            { loop: 1, address: 81, model: 'IM', deviceType: 'Monitor', serialNumber: '3698972574', messages: 'ISOLATOR MODULE 1ST FLOOR FACP' },
            { loop: 1, address: 82, model: 'IM', deviceType: 'Monitor', serialNumber: '3698973106', messages: 'ISOLATOR MODULE 2ND FLOOR FACP' },
            { loop: 1, address: 83, model: 'IM', deviceType: 'Monitor', serialNumber: '3698973830', messages: 'ISOLATOR MODULE 2ND FLR DORMS FACP' },
            // Modules
            { loop: 1, address: 126, model: '278', deviceType: 'Pull Station', serialNumber: '4899926137', messages: 'BASEMENT PULL STAIR B' },
            { loop: 1, address: 127, model: '278', deviceType: 'Pull Station', serialNumber: '4899926700', messages: '2ND FLOOR PULL APP. BAY STORAGE' },
            { loop: 1, address: 128, model: '278', deviceType: 'Pull Station', serialNumber: '4899925901', messages: 'BASEMENT PULL STAIRWELL A' },
            { loop: 1, address: 129, model: 'CT2', deviceType: 'Supervisory Non-Latching', serialNumber: '4922818507', messages: 'ZONE #1 CONTROL VALVE ACTIVE' },
            { loop: 1, address: 130, model: 'CT2', deviceType: 'Supervisory Non-Latching', serialNumber: '4922818514', messages: 'ZONE #2 CONTROL VALVE ACTIVE' },
            { loop: 1, address: 131, model: 'CT2', deviceType: 'Water Flow NoDelay', serialNumber: '4922828643', messages: 'ZONE #1 WATEFLOW ACTIVE' },
            { loop: 1, address: 132, model: 'CT2', deviceType: 'Water Flow NoDelay', serialNumber: '4922828650', messages: 'ZONE #2 WATERFLOW ACTIVE' },
            { loop: 1, address: 133, model: 'CT1', deviceType: 'Supervisory Non-Latching', serialNumber: '4800233804', messages: 'BASEMENT ELEV EQUIP POWER MONITOR' },
            { loop: 1, address: 134, model: 'CR', deviceType: 'Relay Non-Silenceable', serialNumber: '5222515448', messages: 'BASEMENT ELEV EQUIP SHUNT TRIP' },
            { loop: 1, address: 135, model: 'CR', deviceType: 'Relay Non-Silenceable', serialNumber: '5222516698', messages: 'ELEVATOR MAIN RECALL' },
            { loop: 1, address: 136, model: 'CR', deviceType: 'Relay Non-Silenceable', serialNumber: '5222516971', messages: 'ELEVATOR SECONDARY RECALL' },
            { loop: 1, address: 137, model: 'CR', deviceType: 'Relay Non-Silenceable', serialNumber: '5222516896', messages: 'ELEVATOR HAT' },
            { loop: 1, address: 138, model: '278', deviceType: 'Pull Station', serialNumber: '4899919580', messages: '1ST FLOOR PULL S/W APP BAY EXIT' },
            { loop: 1, address: 139, model: '278', deviceType: 'Pull Station', serialNumber: '4899926144', messages: '1ST FLOOR PULL TURN-OUT GEAR EXIT' },
            { loop: 1, address: 140, model: '278', deviceType: 'Pull Station', serialNumber: '4899919313', messages: '1ST FLOOR PULL ANTIQUE BAY EXIT' },
            { loop: 1, address: 141, model: 'CR', deviceType: 'Relay Non-Silenceable', serialNumber: '5222516957', messages: '1ST FLOOR DUCT CR AHU SHUTDOWN STAIR B' },
            { loop: 1, address: 142, model: 'CR', deviceType: 'Relay Non-Silenceable', serialNumber: '5222516841', messages: '1ST FLOOR DUCT CR AHU SHUTDOWN STAIR B' },
            { loop: 1, address: 143, model: 'CT2', deviceType: 'Supervisory Non-Latching', serialNumber: '4925797465', messages: 'DIALER TROUBLE PENTHOUSE BOSCH' },
            { loop: 1, address: 144, model: 'CR', deviceType: 'Relay Non-Silenceable', serialNumber: '5221949961', messages: 'AHU #3 SHUTDOWN' },
            { loop: 1, address: 145, model: '278', deviceType: 'Pull Station', serialNumber: '4899927172', messages: '1ST FLOOR PULL STAIRWELL B' },
            { loop: 1, address: 146, model: '278', deviceType: 'Pull Station', serialNumber: '4899919245', messages: '1ST FLOOR PULL STAIRWELL A' },
            { loop: 1, address: 147, model: '278', deviceType: 'Pull Station', serialNumber: '4899928186', messages: '1ST FLOOR PULL SOUTH VESTIBULE' },
            { loop: 1, address: 148, model: '278', deviceType: 'Pull Station', serialNumber: '4899928094', messages: '1ST FLOOR PULL COURT/TRAINING RM' },
            { loop: 1, address: 149, model: '278', deviceType: 'Pull Station', serialNumber: '4899927097', messages: '1ST FLOOR PULL OUTSIDE INTERVIEW RM' },
            { loop: 1, address: 150, model: '278', deviceType: 'Pull Station', serialNumber: '4899926434', messages: '1ST FLOOR PULL MAIN VESTIBULE' },
            { loop: 1, address: 151, model: '278', deviceType: 'Pull Station', serialNumber: '4899926304', messages: '1ST FLOOR PULL POLICE VESTIBULE' },
            { loop: 1, address: 152, model: '278', deviceType: 'Pull Station', serialNumber: '4899930905', messages: '1ST FLOOR PULL POLICE GARAGE 3/3' },
            { loop: 1, address: 153, model: '278', deviceType: 'Pull Station', serialNumber: '4899919788', messages: '1ST FLOOR PULL POLICE GARAGE 2/3' },
            { loop: 1, address: 154, model: '278', deviceType: 'Pull Station', serialNumber: '4899919849', messages: 'PENTHOUSE TO ROOF ACCESS' },
            { loop: 1, address: 155, model: '278', deviceType: 'Pull Station', serialNumber: '4899926717', messages: '2ND FLOOR PULL STAIRWELL B' },
            { loop: 1, address: 156, model: 'CT1', deviceType: 'Supervisory Non-Latching', serialNumber: '4800233392', messages: '2ND FLOOR RANGE HOOD NEED TO TEST' },
            { loop: 1, address: 157, model: '278', deviceType: 'Pull Station', serialNumber: '4899927875', messages: '2ND FLOOR PULL KITCHEN TO APP BAY' },
            { loop: 1, address: 158, model: 'CR', deviceType: 'Relay Non-Silenceable', serialNumber: '5221705154', messages: 'BASEMENT CR DOOR HOLDER' },
            { loop: 1, address: 159, model: '278', deviceType: 'Pull Station', serialNumber: '4899931070', messages: '2ND FLOOR PULL STAIRWELL A' },
            { loop: 1, address: 160, model: 'CT2', deviceType: 'Supervisory Non-Latching', serialNumber: '4921144881', messages: 'BACK FLOW SECONDARY CONTROL VALVE ACTIVE' },
            { loop: 1, address: 161, model: 'CT2', deviceType: 'Supervisory Non-Latching', serialNumber: '4921144898', messages: 'BACKFLOW PRIMARY CONTROL VALVE ACTIVE' },
            { loop: 1, address: 162, model: 'CT2', deviceType: 'Supervisory Non-Latching', serialNumber: '4925797472', messages: 'DIALER/NOT USED CT2 TO BOSCH CELL' },
            { loop: 1, address: 163, model: 'CR', deviceType: 'Relay Non-Silenceable', serialNumber: '5225324788', messages: 'TROUBLE TO BOSCH PENTHOUSE FIRE' },
            { loop: 1, address: 164, model: '278', deviceType: 'Pull Station', serialNumber: '4899918859', messages: '1ST FLOOR PULL POLICE GARAGE 1/3' },
            { loop: 1, address: 165, model: 'CR', deviceType: 'Relay Non-Silenceable', serialNumber: '5223936815', messages: 'PENTHOUSE FIRE ALARM TO BOSCH DIALER' },
            { loop: 1, address: 166, model: 'CR', deviceType: 'Relay Non-Silenceable', serialNumber: '5222572595', messages: 'PENTHOUSE CO ALARM TO BOSCH DIALER' },
            { loop: 1, address: 167, model: 'CT2', deviceType: 'Supervisory Latching', serialNumber: '4922828803', messages: '2ND FLOOR CO' },
            { loop: 1, address: 168, model: 'CT2', deviceType: 'Supervisory Latching', serialNumber: '4922828810', messages: 'INPUT 2 FOR CO\'S NOT USED' },
            { loop: 1, address: 180, model: 'CR', deviceType: 'Relay Non-Silenceable', serialNumber: '5221061762', messages: 'PENTHOUSE FIRE SUP TO BOSCH DIALER' },
            { loop: 1, address: 181, model: 'CRR', deviceType: 'Relay Non-Silenceable', serialNumber: '5221663690', messages: 'SOUNDER BASE RELAY' },
            { loop: 1, address: 182, model: 'CR', deviceType: 'Relay Non-Silenceable', serialNumber: '5216256135', messages: 'DOOR ACCESS RELAY' },
            { loop: 1, address: 183, model: '278', deviceType: 'Pull Station', serialNumber: '4899919535', messages: 'BASEMENT PULL NEXT TO FACP' },
            { loop: 1, address: 185, model: 'CC1S', deviceType: 'Genesis Audible Visible Silence', serialNumber: '5074492140', messages: '1ST FLOOR CC1S POLICE IT CLOSET' },
            { loop: 1, address: 186, model: 'CR', deviceType: 'Relay Non-Silenceable', serialNumber: '5222516872', messages: 'FIRE ROLL UP DOOR' },
            { loop: 1, address: 187, model: 'RM1', deviceType: 'Monitor', serialNumber: '5798621253', messages: 'SOUNDER BASE PWR MONITOR' },
            { loop: 1, address: 188, model: 'CC1S', deviceType: 'Genesis Audible Visible Silence', serialNumber: '5066206359', messages: 'BPS RM F003 NEXT TO FACP' },
            { loop: 1, address: 189, model: 'CC1S', deviceType: 'Genesis Audible Visible Silence', serialNumber: '5066291058', messages: 'FURTHEST FROM PANEL BPS RM F003' },
            // Annunciators
            { loop: 'N/A', address: 1, model: 'LCD C', deviceType: 'Annunciator', serialNumber: 'N/A', messages: 'MCFARLAND PUBLIC BLD FIRE PANEL NORMAL' },
            { loop: 'N/A', address: 2, model: 'LCD C', deviceType: 'Annunciator', serialNumber: 'N/A', messages: 'MCFARLAND PUBLIC BLD FIRE PANEL NORMAL' },
            // NAC
            { loop: 'N/A', address: 1, model: 'Genesis', deviceType: 'NAC', serialNumber: 'N/A', messages: 'Bell Active' },
            { loop: 'N/A', address: 2, model: 'Genesis', deviceType: 'NAC', serialNumber: 'N/A', messages: 'NAC 2' },
            { loop: 'N/A', address: 3, model: 'Genesis', deviceType: 'NAC', serialNumber: 'N/A', messages: 'NAC 3' },
            { loop: 'N/A', address: 4, model: 'Genesis', deviceType: 'NAC', serialNumber: 'N/A', messages: 'NAC 4' },
        ];


        // --- APPLICATION LOGIC ---
        document.addEventListener('DOMContentLoaded', () => {
            const deviceListContainer = document.getElementById('device-list');
            const completedDeviceListContainer = document.getElementById('completed-device-list');
            const searchInput = document.getElementById('search');
            const sortBySelect = document.getElementById('sortBy');
            const clearAllButton = document.getElementById('clear-all');
            const previousDeviceFooter = document.getElementById('previous-device-footer');
            const previousDeviceText = document.getElementById('previous-device-text');
            const progressBar = document.getElementById('progress-bar');
            const progressStats = document.getElementById('progress-stats');
            const completedCount = document.getElementById('completed-count');

            let state = {
                checkedDevices: new Set(),
                lastChecked: null
            };
            
            const createDeviceCard = (device) => {
                const uniqueId = `${device.loop}-${device.address}`;
                const isChecked = state.checkedDevices.has(uniqueId);
                const checkedClass = isChecked ? 'checked' : '';
                
                let badgeText;
                if (device.loop !== 'N/A') {
                    badgeText = `Loop ${device.loop} &bull; Addr ${device.address}`;
                } else {
                    badgeText = `${device.deviceType} ${device.address}`;
                }

                return `
                    <div id="card-${uniqueId}" class="device-card p-4 flex items-center gap-4 relative ${checkedClass}">
                        <div class="flex-shrink-0">
                            <input type="checkbox" id="check-${uniqueId}" class="custom-checkbox" ${isChecked ? 'checked' : ''}>
                        </div>
                        <div class="flex-grow pr-4">
                            <label for="check-${uniqueId}" class="block cursor-pointer">
                                <p class="font-semibold text-lg text-slate-800 pr-16">${device.messages}</p>
                                <div class="mt-2 grid grid-cols-2 sm:grid-cols-3 gap-x-4 gap-y-1 text-sm text-slate-500">
                                    <div><span class="font-medium">Model:</span> ${device.model}</div>
                                    <div class="col-span-2 sm:col-span-1"><span class="font-medium">Type:</span> ${device.deviceType}</div>
                                    <div class="col-span-2 sm:col-span-3"><span class="font-medium">S/N:</span> ${device.serialNumber}</div>
                                </div>
                            </label>
                        </div>
                        <div class="absolute top-3 right-3 bg-slate-100 text-slate-600 text-xs font-semibold px-2 py-1 rounded-full whitespace-nowrap">
                           ${badgeText}
                        </div>
                    </div>
                `;
            };
            
            const updateProgress = () => {
                const checkedCount = state.checkedDevices.size;
                const totalCount = devices.length;
                const percentage = totalCount > 0 ? Math.round((checkedCount / totalCount) * 100) : 0;
                
                progressBar.style.width = `${percentage}%`;
                progressBar.textContent = `${percentage}%`;
                progressStats.textContent = `${checkedCount} / ${totalCount} Devices Checked`;
                completedCount.textContent = checkedCount;
            };

            const renderAllLists = (allVisibleDevices) => {
                const uncheckedHTML = allVisibleDevices
                    .filter(d => !state.checkedDevices.has(`${d.loop}-${d.address}`))
                    .map(createDeviceCard)
                    .join('');

                const checkedHTML = allVisibleDevices
                    .filter(d => state.checkedDevices.has(`${d.loop}-${d.address}`))
                    .map(createDeviceCard)
                    .join('');

                deviceListContainer.innerHTML = uncheckedHTML || '<p class="text-slate-500">All remaining devices are complete!</p>';
                completedDeviceListContainer.innerHTML = checkedHTML || '<p class="text-slate-500">No devices checked off yet.</p>';
            };
            
            const saveState = () => {
                const appState = {
                    checked: Array.from(state.checkedDevices),
                    lastChecked: state.lastChecked
                };
                localStorage.setItem('deviceChecklistState', JSON.stringify(appState));
            };
            
            const loadState = () => {
                const savedState = localStorage.getItem('deviceChecklistState');
                if (savedState) {
                    const parsedState = JSON.parse(savedState);
                    state.checkedDevices = new Set(parsedState.checked || []);
                    state.lastChecked = parsedState.lastChecked || null;

                    if (state.lastChecked) {
                        const device = findDevice(state.lastChecked.loop, state.lastChecked.address);
                        if(device) {
                            updatePreviousDeviceFooter(device);
                        }
                    }
                }
            };
            
            const findDevice = (loop, address) => {
                return devices.find(d => String(d.loop) === String(loop) && String(d.address) === String(address));
            };

            const updatePreviousDeviceFooter = (device) => {
                if (device) {
                    const idText = device.loop !== 'N/A' ? `L${device.loop}/A${device.address}` : `${device.deviceType} ${device.address}`;
                    previousDeviceText.textContent = `${idText}: ${device.messages}`;
                    previousDeviceFooter.classList.remove('hidden');
                } else {
                    previousDeviceFooter.classList.add('hidden');
                }
            };

            const handleCheck = (e) => {
                const checkbox = e.target;
                if (!checkbox.id || !checkbox.id.startsWith('check-')) return;
                
                const uniqueId = checkbox.id.replace('check-', '');
                const [loop, address] = uniqueId.split('-');

                if (checkbox.checked) {
                    state.checkedDevices.add(uniqueId);
                    const device = findDevice(loop, address);
                    state.lastChecked = { loop, address };
                    updatePreviousDeviceFooter(device);
                } else {
                    state.checkedDevices.delete(uniqueId);
                }
                
                saveState();
                updateProgress();
                filterAndSort(); // Re-render both lists
            };

            const filterAndSort = () => {
                const searchTerm = searchInput.value.toLowerCase();
                const sortBy = sortBySelect.value;

                let filtered = devices.filter(d => {
                    const combinedString = `${d.messages} ${d.model} ${d.deviceType} ${d.serialNumber} ${d.address}`.toLowerCase();
                    return combinedString.includes(searchTerm);
                });

                filtered.sort((a, b) => {
                    switch (sortBy) {
                        case 'address':
                            return a.address - b.address;
                        case 'address-desc':
                            return b.address - a.address;
                        case 'loop':
                            if (a.loop === 'N/A' && b.loop !== 'N/A') return 1;
                            if (b.loop === 'N/A' && a.loop !== 'N/A') return -1;
                            return a.loop - b.loop;
                        case 'model':
                            return a.model.localeCompare(b.model);
                        case 'deviceType':
                             return a.deviceType.localeCompare(b.deviceType);
                        default:
                            return 0;
                    }
                });

                renderAllLists(filtered);
            };

            const handleClearAll = () => {
                state.checkedDevices.clear();
                state.lastChecked = null;
                saveState();
                updateProgress();
                updatePreviousDeviceFooter(null);
                filterAndSort(); 
            };

            // --- EVENT LISTENERS ---
            searchInput.addEventListener('input', filterAndSort);
            sortBySelect.addEventListener('change', filterAndSort);
            clearAllButton.addEventListener('click', handleClearAll);
            
            // Delegate events from both containers
            document.body.addEventListener('change', handleCheck);


            // --- INITIALIZATION ---
            loadState();
            updateProgress();
            filterAndSort(); // Initial render
        });
    </script>
</body>
</html>
